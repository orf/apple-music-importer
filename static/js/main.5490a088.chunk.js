(this["webpackJsonpapple-music-importer"]=this["webpackJsonpapple-music-importer"]||[]).push([[0],{142:function(e,t,r){},146:function(e,t,r){"use strict";r.r(t);var n=r(0),c=r.n(n),a=r(30),i=r.n(a),s=r(11),u=r(152),l=r(153),o=r(1);var h=function(e){var t=e.callback;return Object(o.jsx)(u.a,{children:Object(o.jsxs)("div",{className:"px-4 py-5 my-5 text-center",children:[Object(o.jsx)("h1",{className:"display-5 fw-bold",children:"Apple Music Library.xml Importer"}),Object(o.jsxs)("div",{className:"col-lg-6 mx-auto",children:[Object(o.jsx)("p",{className:"lead mb-4",children:"This is a web-based tool that imports a library.xml file exported from Apple Music back into your account."}),Object(o.jsx)("p",{className:"lead mb-4",children:"I built this because Apple Music deletes your entire library if you move country, and there isn't a simple way to recover it."}),Object(o.jsx)("div",{className:"d-grid gap-2 d-sm-flex justify-content-sm-center",children:Object(o.jsx)(l.a,{onClick:t,size:"lg",variant:"primary",children:"Login with Apple"})})]})]})})},j=r(23),b=r.n(j),d=r(40),m=r(101),f=r(156),p=r(157),x=r(162),O=r(100),y=r(154),v=r(155),k=r(74);var g=function(e){var t=e.foundTracks,r=e.searcher,c=Object(n.useState)(!1),a=Object(s.a)(c,2),i=a[0],u=a[1],h=Object(n.useState)(0),j=Object(s.a)(h,2),b=j[0],d=j[1],m=Object(n.useMemo)((function(){return Object(k.chunk)(t,40)}),[t]);Object(n.useEffect)((function(){i&&m.forEach((function(e){r.import(e.map((function(e){return e.trackId}))).finally((function(){d((function(e){return e+1}))}))}))}),[r,i,m]);var f=b/m.length*100;return i?Object(o.jsxs)("div",{children:[Object(o.jsx)(y.a,{now:f,label:"Importing Songs: ".concat(f.toFixed(0),"%")}),Object(o.jsx)("p",{children:"This may take a while, Apple Music has very low request limits"})]}):Object(o.jsx)(l.a,{variant:"primary",onClick:function(){return u(!0)},children:"Import My Library"})};MusicKit.MusicKitInstance;var I=function(e){e.musicKitInstance;var t=e.searchManager,r=Object(n.useState)([]),c=Object(s.a)(r,2),a=c[0],i=c[1],l=Object(n.useState)([]),h=Object(s.a)(l,2),j=h[0],b=h[1],d=Object(n.useState)(!1),f=Object(s.a)(d,2),p=f[0],x=f[1];Object(n.useEffect)((function(){t.startSearching(i,b).finally((function(){return x(!0)}))}),[t,b,i]);var O=(a.length+j.length)/t.library.length*100,I=Object(n.useMemo)((function(){return Object(k.uniqBy)(a,(function(e){return e.albumArt}))}),[a]);return Object(o.jsxs)("div",{children:[Object(o.jsx)(u.a,{children:Object(o.jsx)(m.a,{className:"d-flex flex-column justify-content-center align-items-center",children:Object(o.jsxs)("h3",{children:[t.library.length," tracks in your library"]})})}),Object(o.jsx)(u.a,{children:Object(o.jsx)(m.a,{sm:{span:6,offset:3},className:"d-flex flex-column justify-content-center",children:p?Object(o.jsx)(g,{foundTracks:a,searcher:t}):Object(o.jsx)(y.a,{now:O,label:"".concat(O.toFixed(0),"%")})})}),Object(o.jsx)("br",{}),Object(o.jsxs)(u.a,{children:[Object(o.jsxs)(m.a,{sm:{span:8},children:[Object(o.jsx)(u.a,{children:Object(o.jsx)(m.a,{className:"d-flex flex-column justify-content-center align-items-center",children:Object(o.jsxs)("h4",{children:["Found ",a.length," Tracks from ",I.length," albums"]})})}),Object(o.jsx)(u.a,{children:Object(o.jsx)(m.a,{className:"d-flex flex-column min-vh-100",children:Object(o.jsx)(u.a,{className:"g-0",children:I.map((function(e,t){return Object(o.jsx)(m.a,{className:"flex-grow-0",children:Object(o.jsx)(v.a,{src:e.albumArtUrl(50)})},t)}))})})})]}),Object(o.jsxs)(m.a,{children:[Object(o.jsx)(u.a,{children:Object(o.jsx)(m.a,{className:"d-flex flex-column justify-content-center align-items-center",children:Object(o.jsxs)("h4",{children:["Missing ",j.length," Tracks"]})})}),Object(o.jsx)(u.a,{children:Object(o.jsx)(m.a,{className:"d-flex flex-column min-vh-100",children:Object(o.jsx)("ul",{children:j.map((function(e,t){return Object(o.jsxs)("li",{children:[e.track.Name," - ",e.track.Album," - ",e.track.Artist]},t)}))})})})]})]})]})},w=r(56),A=r(35),M=r(39),N=r(89),S=(MusicKit.MusicKitInstance,function(){function e(t,r,n){Object(A.a)(this,e),this.track=void 0,this.trackId=void 0,this.albumArt=void 0,this.track=t,this.trackId=r,this.albumArt=n}return Object(M.a)(e,[{key:"albumArtUrl",value:function(e){return this.albumArt.replace("{w}",e.toString()).replace("{h}",e.toString())}}]),e}()),T=function e(t){Object(A.a)(this,e),this.track=void 0,this.track=t},K=function(){function e(t,r){Object(A.a)(this,e),this.musicKit=void 0,this.library=void 0,this.searchSemaphore=void 0,this.addRateLimit=void 0,this.cache=void 0,this.musicKit=t,this.searchSemaphore=new N.Sema(10),this.addRateLimit=Object(N.RateLimit)(.4,{timeUnit:1e3,uniformDistribution:!0}),this.library=r,this.cache={}}return Object(M.a)(e,[{key:"import",value:function(){var e=Object(d.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addRateLimit();case 2:return e.next=4,this.musicKit.api.addToLibrary({songs:t});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startSearching",value:function(){var e=Object(d.a)(b.a.mark((function e(t,r){var n,c=this;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t([]),r([]),n=this.library.map((function(e){return c.search(e).then((function(e){e instanceof S?t((function(t){return[].concat(Object(w.a)(t),[e])})):r((function(t){return[].concat(Object(w.a)(t),[e])}))}))})),e.next=5,Promise.all(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=Object(d.a)(b.a.mark((function e(t){var r,n,c,a,i,s,u;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.LibraryId in this.cache)){e.next=2;break}return e.abrupt("return",this.cache[t.LibraryId]);case 2:return e.next=4,this.searchSemaphore.acquire();case 4:r=e.sent,e.prev=5,n=["".concat(t.Name," - ").concat(t.Album," - ").concat(t.Artist),"".concat(t.Name," -  ").concat(t.Artist)],c=0,a=n;case 8:if(!(c<a.length)){e.next=19;break}return i=a[c],e.next=12,this.doSearch(i,t);case 12:if(null==(s=e.sent)){e.next=16;break}return this.cache[t.LibraryId]=s,e.abrupt("return",s);case 16:c++,e.next=8;break;case 19:return u=new T(t),this.cache[t.LibraryId]=u,e.abrupt("return",u);case 22:return e.prev=22,e.next=25,this.searchSemaphore.release(r);case 25:return e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[5,,22,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"doSearch",value:function(){var e=Object(d.a)(b.a.mark((function e(t,r){var n,c,a,i;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.musicKit.api.search(t);case 2:if(n=e.sent,(c=n).songs){e.next=8;break}return e.abrupt("return",null);case 8:return a=c.songs.data[0].attributes.artwork.url,i=c.songs.data[0].id,e.abrupt("return",new S(r,i,a));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),L=K;MusicKit.MusicKitInstance;function C(){return(C=Object(d.a)(b.a.mark((function e(t){var r,n,c,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null,"files"in t.currentTarget&&(r=null===(n=t.currentTarget.files)||void 0===n?void 0:n[0]),r){e.next=4;break}return e.abrupt("return",null);case 4:return e.next=6,r.text();case 6:return c=e.sent,a=Object(O.parse)(c),e.abrupt("return",Object.values(a.Tracks).map((function(e){return{LibraryId:e["Track ID"],Artist:e.Artist,Name:e.Name,Album:e.Album}})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(e){var t=e.musicKitInstance,r=Object(n.useState)(!1),c=Object(s.a)(r,2),a=c[0],i=c[1],l=Object(n.useState)(null),h=Object(s.a)(l,2),j=h[0],b=h[1],d=Object(n.useState)(null),O=Object(s.a)(d,2),y=O[0],v=O[1];if(null!=y&&!a&&!j){var k=new L(t,y);return Object(o.jsx)(I,{musicKitInstance:t,searchManager:k})}return Object(o.jsx)(u.a,{children:Object(o.jsxs)(m.a,{className:"d-flex flex-column min-vh-100 justify-content-center align-items-center",children:[Object(o.jsx)("h1",{children:"Upload your library.xml file"}),Object(o.jsx)("p",{children:"The file never leaves your browser, and this app is programmed not to judge your taste in music."}),a?Object(o.jsx)("div",{children:Object(o.jsx)(f.a,{animation:"border",role:"status"})}):Object(o.jsxs)("div",{children:[null!=j&&Object(o.jsxs)(p.a,{variant:"danger",children:[Object(o.jsx)(p.a.Heading,{children:"Error parsing library file - are you sure this is an Apple music library.xml file?"}),Object(o.jsxs)("p",{children:["The Error thrown was: ",j.toString()]})]}),Object(o.jsx)(x.a.Group,{controlId:"formFile",className:"mb-3",children:Object(o.jsx)(x.a.Control,{type:"file",onChange:function(e){i(!0),b(null),function(e){return C.apply(this,arguments)}(e).then((function(e){return v(e)})).catch((function(e){return b(e)})).finally((function(){return i(!1)}))}})})]})]})})};MusicKit.MusicKitInstance;var J=function(e){var t=e.musicKitInstance,r=Object(n.useState)(t.isAuthorized),c=Object(s.a)(r,2),a=c[0],i=c[1];return a?Object(o.jsx)(E,{musicKitInstance:t}):Object(o.jsx)(h,{callback:function(){t.authorize().then((function(e){return i(!0)}))}})},F=(r(141),r(142),r(159)),R=r(161),U=r(163),z=r(160),V=r(105);z.a({dsn:"https://5e5a8ce1c7a24928a5f2e484accee607@o1083910.ingest.sentry.io/6093765",integrations:[new V.a.BrowserTracing],tracesSampleRate:1});var W=MusicKit.configure({developerToken:"eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiIsImtpZCI6IloyTDRWRFpXRFAifQ.eyJpc3MiOiJEQVQ1VU1aWU03IiwiaWF0IjoxNjM4NjYzNTk2LCJleHAiOjE2NTE2MTk5OTZ9.9iCTRy0hmCvT52tzcJMKhI8oiZoJWiC_pxuI0U3TZk01e5nmAc8E5WAqprOafk2wH9pLEM0M6jhVf6Ic0V-PoA",app:{name:"Library.xml importer",icon:"/apple-music-importer/logo192.png"}});i.a.render(Object(o.jsxs)(c.a.StrictMode,{children:[Object(o.jsx)(F.a,{fluid:!0,children:Object(o.jsx)(J,{musicKitInstance:W})}),Object(o.jsx)(R.a,{color:"dark",fixed:"bottom",children:Object(o.jsx)(F.a,{children:Object(o.jsx)(R.a.Collapse,{className:"justify-content-end",children:Object(o.jsxs)(U.a,{children:[Object(o.jsx)(U.a.Link,{target:"blank",href:"https://tomforb.es",children:"Made by Tom Forbes"}),Object(o.jsx)(U.a.Link,{target:"blank",href:"https://github.com/orf/apple-music-importer",children:"Source Code"})]})})})})]}),document.getElementById("root"))}},[[146,1,2]]]);
//# sourceMappingURL=main.5490a088.chunk.js.map